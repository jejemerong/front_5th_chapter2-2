import{r as x,j as e,c as A,R as q}from"./client-DD4c7S6m.js";const P=(s,n)=>{const a=n.find(t=>t.product.id===s.id);return s.stock-((a==null?void 0:a.quantity)||0)},F=s=>s.reduce((n,a)=>Math.max(n,a.rate),0),S=s=>{const{discounts:n}=s.product,{quantity:a}=s;let t=0;for(const o of n)a>=o.quantity&&(t=Math.max(t,o.rate));return t},I=(s,n)=>{const a=s.reduce((u,l)=>u+l.product.price*l.quantity,0),t=s.reduce((u,l)=>{const h=S(l),i=l.product.price*l.quantity;return u+i*(1-h)},0),o=E(t,n),d=a-o;return{totalBeforeDiscount:a,totalAfterDiscount:o,totalDiscount:d}},E=(s,n)=>n?n.discountType==="amount"?Math.max(0,s-n.discountValue):s*(1-n.discountValue/100):s,V=(s,n,a)=>a<=0?s.filter(o=>o.product.id!==n):s.map(o=>o.product.id===n?{...o,quantity:Math.min(a,o.product.stock)}:o),R=(s,n)=>s.find(t=>t.product.id===n.id)?s.map(t=>t.product.id===n.id?{...t,quantity:Math.min(t.quantity+1,n.stock)}:t):[...s,{product:n,quantity:1}],$=(s,n)=>s.filter(a=>a.product.id!==n),M=()=>{const[s,n]=x.useState([]),[a,t]=x.useState(null);return{cart:s,addToCart:i=>{P(i,s)!==0&&n(m=>R(m,i))},removeFromCart:i=>{n(m=>$(m,i))},updateQuantity:(i,m)=>{n(g=>V(g,i,m))},applyCoupon:i=>{t(i)},calculateTotal:()=>{const{totalBeforeDiscount:i,totalAfterDiscount:m,totalDiscount:g}=I(s,a);return{totalBeforeDiscount:i,totalAfterDiscount:m,totalDiscount:g}},selectedCoupon:a}},U=s=>{const[n,a]=x.useState(s);return{coupons:n,addCoupon:o=>{a([...n,o])}}},L=s=>{const[n,a]=x.useState(s);return{products:n,updateProduct:t=>{a(o=>o.map(d=>d.id===t.id?t:d))},addProduct:t=>{a(o=>[...o,t])}}},B={page:{Element:"h1",className:"text-3xl font-bold mb-6"},section:{Element:"h2",className:"text-2xl font-semibold mb-4"},subSection:{Element:"h2",className:"text-2xl font-semibold mb-2"},miniSection:{Element:"h3",className:"text-lg font-semibold mb-2"}},b=({title:s,level:n})=>{const{Element:a,className:t}=B[n];return e.jsx(a,{className:t,children:s})},O=({coupons:s,selectedCoupon:n,onCouponApply:a})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx(b,{title:"쿠폰 적용",level:"subSection"}),e.jsxs("select",{onChange:t=>a(s[parseInt(t.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),s.map((t,o)=>e.jsx("option",{value:o,children:e.jsx(H,{coupon:t})},t.code))]}),n&&e.jsx(Q,{coupon:n})]}),H=({coupon:s})=>{const n=D(s);return e.jsxs(e.Fragment,{children:[s.name," - ",n]})},Q=({coupon:s})=>{const n=D(s);return e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",s.name,"(",n," 할인)"]})},D=s=>s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`,W=({cart:s,updateQuantity:n,removeFromCart:a})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{title:"장바구니 내역",level:"section"}),s.map(t=>{const o=S(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,o>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(o*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>n(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>n(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>a(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},t.product.id)})]}),_=({onClick:s,disabled:n,children:a})=>e.jsx("button",{onClick:s,className:`w-full px-3 py-1 rounded ${n?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:n,children:a}),G=({products:s,cart:n,addToCart:a})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{title:"상품 목록",level:"section"}),s.map(t=>{const o=P(t,n);return e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${o>0?"text-green-600":"text-red-600"}`,children:["재고: ",o,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(F(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((d,u)=>e.jsxs("li",{children:[d.quantity,"개 이상:"," ",(d.rate*100).toFixed(0),"% 할인"]},u))}),e.jsx(_,{onClick:()=>a(t),disabled:o<=0,children:o>0?"장바구니에 추가":"품절"})]},t.id)})]}),z=({totalBeforeDiscount:s,totalDiscount:n,totalAfterDiscount:a})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx(b,{title:"주문 요약",level:"subSection"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",n.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",a.toLocaleString(),"원"]})]})]}),J=({products:s,coupons:n})=>{const{cart:a,addToCart:t,removeFromCart:o,updateQuantity:d,calculateTotal:u,applyCoupon:l,selectedCoupon:h}=M(),{totalBeforeDiscount:i,totalAfterDiscount:m,totalDiscount:g}=u();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(b,{title:"장바구니",level:"page"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(G,{products:s,cart:a,addToCart:t}),e.jsxs("div",{children:[e.jsx(W,{cart:a,updateQuantity:d,removeFromCart:o}),e.jsx(O,{coupons:n,selectedCoupon:h,onCouponApply:l}),e.jsx(z,{totalBeforeDiscount:i,totalDiscount:g,totalAfterDiscount:m})]})]})]})},K=({coupons:s})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{title:"현재 쿠폰 목록",level:"miniSection"}),s.map((n,a)=>e.jsxs("div",{"data-testid":`coupon-${a+1}`,className:"bg-gray-100 p-2 rounded",children:[n.name," (",n.code,"):",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`," ","할인"]},a))]}),X=({onCouponAdd:s})=>{const[n,a]=x.useState({name:"",code:"",discountType:"percentage",discountValue:0}),t=()=>{s(n),a({name:"",code:"",discountType:"percentage",discountValue:0})};return e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:n.name,onChange:o=>a({...n,name:o.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:n.code,onChange:o=>a({...n,code:o.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:n.discountType,onChange:o=>a({...n,discountType:o.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:n.discountValue,onChange:o=>a({...n,discountValue:parseInt(o.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:t,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]})},Y=({newProduct:s,setNewProduct:n,onAdd:a})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:s.name,onChange:t=>n({...s,name:t.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:s.price,onChange:t=>n({...s,price:parseInt(t.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:s.stock,onChange:t=>n({...s,stock:parseInt(t.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:a,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),Z=s=>{const[n,a]=x.useState(new Set),[t,o]=x.useState(null),[d,u]=x.useState({quantity:0,rate:0}),[l,h]=x.useState(!1),[i,m]=x.useState({name:"",price:0,stock:0,discounts:[]});return{openProductIds:n,editingProduct:t,newDiscount:d,showNewProductForm:l,newProduct:i,setNewDiscount:u,setShowNewProductForm:h,setNewProduct:m,toggleProductAccordion:c=>{a(p=>{const r=new Set(p);return r.has(c)?r.delete(c):r.add(c),r})},handleEditProduct:c=>{o({...c})},handleProductNameUpdate:(c,p)=>{if(t&&t.id===c){const r={...t,name:p};o(r)}},handlePriceUpdate:(c,p)=>{t&&t.id===c&&o({...t,price:p})},handleStockUpdate:(c,p)=>{t&&t.id===c&&o({...t,stock:p})},handleAddDiscount:c=>{if(t&&t.id===c){const p={...t,discounts:[...t.discounts,d]};s(p),o(p),u({quantity:0,rate:0})}},handleRemoveDiscount:(c,p)=>{if(t&&t.id===c){const r={...t,discounts:t.discounts.filter((j,T)=>T!==p)};s(r),o(r)}},handleEditComplete:()=>{t&&(s(t),o(null))}}},ee=s=>s/100,te=s=>s*100,se=({products:s,onProductUpdate:n,onProductAdd:a})=>{const{openProductIds:t,editingProduct:o,newDiscount:d,showNewProductForm:u,newProduct:l,setNewDiscount:h,setShowNewProductForm:i,setNewProduct:m,toggleProductAccordion:g,handleEditProduct:N,handleProductNameUpdate:v,handlePriceUpdate:y,handleStockUpdate:f,handleAddDiscount:w,handleRemoveDiscount:C,handleEditComplete:k}=Z(n);return e.jsxs("div",{children:[u&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:l.name,onChange:c=>m({...l,name:c.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:l.price,onChange:c=>m({...l,price:parseInt(c.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:l.stock,onChange:c=>m({...l,stock:parseInt(c.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:()=>{const c={...l,id:Date.now().toString()};a(c),m({name:"",price:0,stock:0,discounts:[]}),i(!1)},className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),e.jsx("div",{className:"space-y-2",children:s.map((c,p)=>e.jsxs("div",{"data-testid":`product-${p+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>g(c.id),className:"w-full text-left font-semibold",children:[c.name," - ",c.price,"원 (재고: ",c.stock,")"]}),t.has(c.id)&&e.jsx("div",{className:"mt-2",children:o&&o.id===c.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:o.name,onChange:r=>v(c.id,r.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:o.price,onChange:r=>y(c.id,parseInt(r.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:o.stock,onChange:r=>f(c.id,parseInt(r.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),o.discounts.map((r,j)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[r.quantity,"개 이상 구매 시"," ",r.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>C(c.id,j),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},j)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:d.quantity,onChange:r=>h({...d,quantity:parseInt(r.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:te(d.rate),onChange:r=>h({...d,rate:ee(parseInt(r.target.value))}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>w(c.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:k,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[c.discounts.map((r,j)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[r.quantity,"개 이상 구매 시"," ",r.rate*100,"% 할인"]})},j)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>N(c),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},c.id))})]})},ne=({products:s,coupons:n,onProductUpdate:a,onProductAdd:t,onCouponAdd:o})=>{const[d,u]=x.useState(!1),[l,h]=x.useState({name:"",price:0,stock:0,discounts:[]}),i=()=>{const m={...l,id:Date.now().toString()};t(m),h({name:"",price:0,stock:0,discounts:[]}),u(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(b,{title:"관리자 페이지",level:"page"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(b,{title:"상품 관리",level:"section"}),e.jsx("button",{onClick:()=>u(!d),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:d?"취소":"새 상품 추가"}),d&&e.jsx(Y,{newProduct:l,setNewProduct:h,onAdd:i}),e.jsx(se,{products:s,onProductUpdate:a,onProductAdd:t})]}),e.jsxs("div",{children:[e.jsx(b,{title:"쿠폰 관리",level:"section"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(X,{onCouponAdd:o}),e.jsx(K,{coupons:n})]})]})]})]})},ae=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],oe=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],ce=()=>{const{products:s,updateProduct:n,addProduct:a}=L(ae),{coupons:t,addCoupon:o}=U(oe),[d,u]=x.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>u(!d),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:d?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:d?e.jsx(ne,{products:s,coupons:t,onProductUpdate:n,onProductAdd:a,onCouponAdd:o}):e.jsx(J,{products:s,coupons:t})})]})};A.createRoot(document.getElementById("root")).render(e.jsx(q.StrictMode,{children:e.jsx(ce,{})}));
